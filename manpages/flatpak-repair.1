'\" t
.\"     Title: flatpak repair
.\"    Author: Matthew Leeds <matthew.leeds@endlessm.com>
.\" Generator: DocBook XSL Stylesheets vsnapshot <http://docbook.sf.net/>
.\"      Date: 03/29/2019
.\"    Manual: flatpak repair
.\"    Source: flatpak
.\"  Language: English
.\"
.TH "FLATPAK REPAIR" "1" "" "flatpak" "flatpak repair"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
flatpak-repair \- Repair a flatpak installation
.SH "SYNOPSIS"
.HP \w'\fBflatpak\ repair\fR\ 'u
\fBflatpak repair\fR [OPTION...]
.SH "DESCRIPTION"
.PP
Repair a flatpak installation by pruning and reinstalling invalid objects\&. The repair command does all of the following:
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Scan all locally available refs, removing any that don\*(Aqt correspond to a deployed ref\&.
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Verify each commit they point to, removing any invalid objects and noting any missing objects\&.
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Remove any refs that had an invalid object, and any non\-partial refs that had missing objects\&.
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Prune all objects not referenced by a ref, which gets rid of any possibly invalid non\-scanned objects\&.
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Enumerate all deployed refs and re\-install any that are not in the repo (or are partial for a non\-subdir deploy)\&.
.RE
.PP
Note that
\fBflatpak repair\fR
has to be run with root privileges to operate on the system installation\&.
.PP
An alternative command for repairing OSTree repositories is ostree fsck\&.
.SH "OPTIONS"
.PP
The following options are understood:
.PP
\fB\-h\fR, \fB\-\-help\fR
.RS 4
Show help options and exit\&.
.RE
.PP
\fB\-\-user\fR
.RS 4
Repair per\-user installation\&.
.RE
.PP
\fB\-\-system\fR
.RS 4
Repair system\-wide installation\&.
.RE
.PP
\fB\-\-installation=NAME\fR
.RS 4
Repair the system\-wide installation specified by
NAME
among those defined in
/etc/flatpak/installations\&.d/\&. Using
\-\-installation=default
is equivalent to using
\-\-system\&.
.RE
.PP
\fB\-\-dry\-run\fR
.RS 4
Only report inconsistencies, don\*(Aqt make any changes
.RE
.PP
\fB\-\-reinstall\-all\fR
.RS 4
Reinstall all refs, regardless of whether they were removed from the repo or not
.RE
.PP
\fB\-v\fR, \fB\-\-verbose\fR
.RS 4
Print debug information during command processing\&.
.RE
.PP
\fB\-\-ostree\-verbose\fR
.RS 4
Print OSTree debug information during command processing\&.
.RE
.SH "EXAMPLES"
.PP
\fB$ sudo flatpak repair\fR
.PP
\fB$ flatpak repair \-\-user\fR
.SH "SEE ALSO"
.PP
\fBflatpak\fR(1),
\fBostree-fsck\fR(1)
